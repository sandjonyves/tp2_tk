{% extends "base.html" %}
{% block title %}Classification ‚Äì Census{% endblock %}

{% block content %}
<div class="container">

    <div class="page-header">
        <h1>üìä Partie 1 ‚Äì Classification Census</h1>
        <p>Pr√©diction de la classe de revenu (> 50K ou ‚â§ 50K) √† partir des caract√©ristiques socio-d√©mographiques.</p>
    </div>

    <!-- Scores des mod√®les -->
    {% if scores %}
    <section class="section">
        <h2 class="section-title">Performances des Mod√®les</h2>
        <div class="scores-grid">
            {% for name, score in scores.items() %}
            <div class="score-card {% if score == scores.values()|list|max %}score-best{% endif %}">
                <div class="score-name">{{ name }}</div>
                <div class="score-value">{{ "%.2f"|format(score * 100) }}%</div>
                <div class="score-bar">
                    <div class="score-fill" style="width: {{ score * 100 }}%"></div>
                </div>
                {% if score == scores.values()|list|max %}<span class="best-badge">‚úì Meilleur</span>{% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Formulaire de pr√©diction -->
    <section class="section">
        <h2 class="section-title">Pr√©diction de Revenu</h2>
        <div class="form-layout">

            <div class="form-container">
                <form method="POST" action="{{ url_for('census') }}">
                    <div class="form-grid">

                        <div class="form-group">
                            <label>√Çge</label>
                            <input type="number" name="age" value="35" min="18" max="90" required class="form-input">
                        </div>

                        <div class="form-group">
                            <label>Niveau d'√©ducation (1-15)</label>
                            <input type="number" name="education_num" value="10" min="1" max="15" required class="form-input">
                            <small>1=Preschool, 9=HS-grad, 13=Bachelors, 16=Doctorate</small>
                        </div>

                        <div class="form-group">
                            <label>Heures / semaine</label>
                            <input type="number" name="hours_per_week" value="40" min="1" max="99" required class="form-input">
                        </div>

                        <div class="form-group">
                            <label>Gains en capital ($)</label>
                            <input type="number" name="capital_gain" value="0" min="0" required class="form-input">
                        </div>

                        <div class="form-group">
                            <label>Pertes en capital ($)</label>
                            <input type="number" name="capital_loss" value="0" min="0" required class="form-input">
                        </div>

                        <div class="form-group">
                            <label>Niveau d'√©ducation</label>
                            <select name="education" class="form-input">
                                <option value="HS-grad">HS-grad (lyc√©e)</option>
                                <option value="Some-college">Some-college</option>
                                <option value="Bachelors" selected>Bachelors (licence)</option>
                                <option value="Masters">Masters</option>
                                <option value="Doctorate">Doctorate</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Situation maritale</label>
                            <select name="marital_status" class="form-input">
                                <option value="Married-civ-spouse" selected>Mari√©(e)</option>
                                <option value="Never-married">Jamais mari√©(e)</option>
                                <option value="Divorced">Divorc√©(e)</option>
                                <option value="Separated">S√©par√©(e)</option>
                                <option value="Widowed">Veuf/Veuve</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Occupation</label>
                            <select name="occupation" class="form-input">
                                <option value="Exec-managerial" selected>Cadre sup√©rieur</option>
                                <option value="Prof-specialty">Professionnel sp√©cialis√©</option>
                                <option value="Sales">Commerce</option>
                                <option value="Craft-repair">Artisan / R√©paration</option>
                                <option value="Tech-support">Support technique</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Sexe</label>
                            <select name="sex" class="form-input">
                                <option value="Male" selected>Homme</option>
                                <option value="Female">Femme</option>
                            </select>
                        </div>

                    </div>

                    <button type="submit" class="btn btn-blue btn-large">üîç Pr√©dire le revenu</button>
                </form>
            </div>

            <!-- R√©sultat -->
            <div class="result-panel">
                {% if error %}
                <div class="alert alert-error">
                    <strong>Erreur :</strong> {{ error }}
                </div>
                {% endif %}

                {% if prediction %}
                <div class="result-card {% if '>' in prediction %}result-high{% else %}result-low{% endif %}">
                    <div class="result-icon">{{ 'üí∞' if '>' in prediction else 'üìâ' }}</div>
                    <h3>R√©sultat de la pr√©diction</h3>
                    <div class="result-value">{{ prediction }}</div>
                    {% if proba %}
                    <div class="result-confidence">
                        <span>Confiance : </span>
                        <strong>{{ proba }}%</strong>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: {{ proba }}%"></div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="result-placeholder">
                    <div class="placeholder-icon">üìã</div>
                    <p>Remplissez le formulaire et cliquez sur <strong>"Pr√©dire le revenu"</strong> pour obtenir une pr√©diction.</p>
                </div>
                {% endif %}

                <div class="info-box">
                    <h4>‚ÑπÔ∏è √Ä propos</h4>
                    <p>Ce mod√®le a √©t√© entra√Æn√© sur le dataset <strong>Census</strong> avec les m√©thodes d'ensemble vues en cours. La classification binaire pr√©dit si le revenu annuel d√©passe ou non 50 000$.</p>
                </div>
            </div>

        </div>
    </section>

    <!-- Graphiques -->
    <section class="section">
        <h2 class="section-title">Visualisations</h2>
        <div class="plots-grid">
            <div class="plot-card">
                <h4>Influence du param√®tre k ‚Äì KNN</h4>
                <img src="{{ url_for('static', filename='plots/knn_classification.png') }}" alt="KNN k influence">
            </div>
            <div class="plot-card">
                <h4>Importance des variables ‚Äì Random Forest</h4>
                <img src="{{ url_for('static', filename='plots/feature_importance_census.png') }}" alt="Feature Importance">
            </div>
        </div>
    </section>

</div>
{% endblock %}
